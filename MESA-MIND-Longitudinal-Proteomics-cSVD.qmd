---
title: "MESA-MIND-Longitudinal-Proteomics-cSVD"
author: "LekkiWood (LekkiWood@Gmail.com)"
date: today
format:
  pdf:
    pdf-engine: lualatex
    includes:
      in_header: 'gt_packages.sty'
    header-includes:
      - \usepackage{pdflscape}
      - \setkeys{Gin}{width=\linewidth,height=0.9\textheight,keepaspectratio}
    toc: true
    toc-depth: 4
crossref:
  tbl-prefix: "Table"
  fig-prefix: "Figure"
execute:
  echo: false
  warning: false
  message: false
  # ensure chunks run from the project root (where _targets/ lives)
  dir: project
pdf-engine: lualatex
editor: visual
---

```{r}
#| label: load-packages


## Load targets
if (!requireNamespace("targets", quietly = TRUE)) {
  stop("The {targets} package is not installed/available in this render session.")
}

## Load knitr
if (!requireNamespace("knitr", quietly = TRUE)) {
  stop("The {knitr} package is not installed/available in this render session.")
}

## Load quarto
if (!requireNamespace("quarto", quietly = TRUE)) {
  stop("The {quarto} package is not installed/available in this render session.")
}

## Load gtsummary
if (!requireNamespace("gtsummary", quietly = TRUE)) {
  stop("The {gtsummary} package is not installed/available in this render session.")
}

## Load ggplot
if (!requireNamespace("ggplot2", quietly = TRUE)) {
  stop("The {ggplot2} package is not installed/available in this render session.")
}

## Load ggrepel
if (!requireNamespace("ggrepel", quietly = TRUE)) {
  stop("The {ggrepel} package is not installed/available in this render session.")
}

## Load naniar
if (!requireNamespace("naniar", quietly = TRUE)) {
  stop("The {naniar} package is not installed/available in this render session.")
}
```

\newpage

# Important Notes - read me first

```{r}

#| label: read-in-traits-for-sparse-analysis

Traits_db <- targets::tar_read(traits_db)

```

## Version control

-   Always check that you have the most recent version of this document, which - unless I am sending you unfinalized work - is available [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/MESA-MIND-Longitudinal-Proteomics-cSVD.pdf).

    -   An easy check for version control is to make sure this date: `r Sys.Date()`. is the same as on the GitHub file [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/MESA-MIND-Longitudinal-Proteomics-cSVD.pdf).

-   The code for this is analysis available in the same repository ([targets master file here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/_targets.R) and [individual functions here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/tree/main/R))

## Regarding the use of site & race/ethnicity

-   Some MESA field centers did not collect data on individuals from select race / ethnicity groups (see: @tbl-race-by-site). Therefore, only race/ethnicity was included in analyses, with the exception of sample descriptives.

::: landscape
```{r}
#| label: tbl-race-by-site
#| tbl-cap: Field Center by Race / Ethnicity Frequencies 

bold_labels <- c("Race or ethnicity")

table1 <- Traits_db |> 
  dplyr::mutate(
        race_desc = factor(race,
                       levels = c("1", "2", "3", "4"),
                       labels = c("Non-Hispanic White", "Chinese American", "Black/African-American", "Hispanic")),
        site_desc = factor(site,
                       levels = c("0", "1", "2", "3", "4", "5"),
                       labels = c("WFU", "COL","JHU", "MN", "MW", "UCLA"))
      ) |>
gtsummary::tbl_summary(
    include = c(race_desc),
    by = site_desc,
    statistic = list(
      gtsummary::all_continuous() ~ "{mean} ({sd})",
      gtsummary::all_categorical() ~ "{n} / {N} ({p}%)"
    ),# split table by group
    missing = "no", # don't list missing data separately
    digits = gtsummary::all_continuous() ~ 2, 
   ##add in labels
     label = list(race_desc = "Race or ethnicity"),
   type = list(race_desc ~ "categorical") 
) |>
  gtsummary::modify_spanning_header(
    gtsummary::all_stat_cols() ~ "Field Center"
  ) |>
  gtsummary::as_gt() |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::tab_style(
    style = gt::cell_text(weight = "bold"),
    locations = gt::cells_body(
      columns = "label",
      rows = label %in% bold_labels
    )
    ) |>
# Bold *any* spanning headers (includes your "Exam" spanner)
  gt::tab_style(
    style = gt::cell_text(weight = "bold"),
    locations = gt::cells_column_spanners()
  ) 

table1

rm(bold_labels)
rm(table1)

```
:::

# Step 1: Cleaning and Formatting Proteins

```{r}
#| label: load-filename-info


#General QC info
QC_info <- targets::tar_read(build_proteins_QC)

#Final N
finalclean_N_by_exam <- targets::tar_read(Proteins_clean_N)
```

## Input file names

-   A table of protein abundances: `{r} print(unlist(strsplit(QC_info$filenames$raw_proteins_file_name, split="/"))[8])`
-   Sample information to link TOPMed IDs to unique MESA SHARe ID and exam combinations: `{r} print(unlist(strsplit(QC_info$filenames$raw_protein_info_file_name, split="/"))[8])`
-   Keys to link Olink IDs to names compounds: `{r} print(unlist(strsplit(QC_info$filenames$ raw_protein_keys_file_name, split="/"))[8])`
-   A file to bridge SHARe ids (sidno) with MESA IDs (idno) `{r} print(unlist(strsplit(QC_info$filenames$raw_bridgingfile_file_name, split="/"))[7])`

## Raw file info

-   The raw protein abundance file contained information on N=`{r} print(QC_info$raw_inputs$raw_protein_N_all)` protein assays, including those used for QC.

-   When removing assays for QC, the raw protein abundance file contained information on N=`{r} print(QC_info$raw_inputs$raw_protein_N_proteins[1,1])` proteins.

-   The protein abundance file contained information on N=`{r} print(QC_info$raw_inputs$raw_N_all)` sample IDs (i.e., unique participant/exam combinations), including bridging samples.

-   After removing QC samples (including bridging, controls, and one duplicate) the protein abundance file contained information on N=`{r} print(QC_info$raw_inputs$raw_N_nobridge)` sample IDs (i.e., unique participant/exam combinations).

### Formatting

-   Bridging (and other QC) samples were removed.

-   Protein assays used for QC were removed.

-   Proteins that should be excluded due to QC warnings (variable "QC_warning" set to "EXCLUDED") were removed, even though these do not have NPX values.

-   Data were put into wide format, with "SampleID" as the unique ID, "OlinkID" forming the variable names (protein identifiers), and values taken from the "NPX" column.

    -   In wide format, the file contained information on N=`{r} print(QC_info$formatted_protein_file_info$unique_sampleids)` unique sample IDs.

    -   In wide format, the file contained information on N=`{r} print(QC_info$formatted_protein_file_info$duplicated_sampleids)` duplicated sample IDs. ^1^

-   SHARe IDs, and subsequently MESA IDs, were merged into the file with exam information.

-   At this point, the range of unique SHARe ID by exam combinations was N=`{r} range(QC_info$initial_dupes$Freq)[1]` - `{r} range(QC_info$initial_dupes$Freq)[2]`. This indicates no sample ID were duplicated in the assays.

-   The formatted protein file was used to calculate the coefficient of variation (CV) using the formula: CV = sqrt(2`^`(sigma`^`2)-1).

-   A variable called "Retain" was created to indicate whether each protein was (1) unique (i.e., included on only one panel); (2) duplicated, and across all panels had the lowest CV; or (3) duplicated, and across all panels did not have the lowest CV.

-   A final table of protein abundances, with additional variables for SHARe ID, MESA ID, Exam, TOPMed ID and Batch, was created after the steps above, with proteins duplicated across more than one panel cleaned such that only the one with the lowest CV is retained. This file was used in the analysis

-   The number of participants, stratified by exam, in the final file is available in @tbl-final-N-by-exam:

```{r}
#| label: tbl-final-N-by-exam
#| tbl-cap: Final N by exam

knitr::kable(finalclean_N_by_exam, format="latex") #print(knitr::kable(finalclean_N_by_exam))
```

\newpage

# Step 2: Format Phenotypes

```{r}
#| label: read-in-trait-info

Traits_QC_info <- targets::tar_read(traits_QC_info)

missing_cov_info <- targets::tar_read(missing_cov_info)
```

## Input files

-   Covariates from E1: `{r} print(unlist(strsplit(Traits_QC_info$filenames$E1_covs_filename, split="/"))[7])`

-   Covariates from E5: `{r} print(unlist(strsplit(Traits_QC_info$filenames$E5_covs_filename, split="/"))[7])`

-   Covariates from E6: `{r} print(unlist(strsplit(Traits_QC_info$filenames$E6_covs_filename, split="/"))[7])`

-   Afib info: `{r} print(unlist(strsplit(Traits_QC_info$filenames$afib_filename, split="/"))[7])`

-   ApoE info: `{r} print(unlist(strsplit(Traits_QC_info$filenames$apoe_filename, split="/"))[7])`

-   Incident CVD: `{r} print(unlist(strsplit(Traits_QC_info$filenames$cvd_filename, split="/"))[7])`

-   Microbleeds: `{r} print(unlist(strsplit(Traits_QC_info$filenames$mb_filename, split="/"))[7])`

-   Perivascular spaces: `{r} print(unlist(strsplit(Traits_QC_info$filenames$evps_filename, split="/"))[7])`

-   White matter hyperintensities: `{r} print(unlist(strsplit(Traits_QC_info$filenames$wmh_filename, split="/"))[7])`

-   Intracranial volumes: `{r} print(unlist(strsplit(Traits_QC_info$filenames$icv_filename, split="/"))[7])`

-   Fractional anisotropy: `{r} print(unlist(strsplit(Traits_QC_info$filenames$wmfa_filename, split="/"))[7])`

-   White matter hyperintensities: `{r} print(unlist(strsplit(Traits_QC_info$filenames$wmh_filename, split="/"))[7])`

## Formatting

### Outcomes:

-   Microbleeds were coded as 0/1, where 0= no microbleeds (value: 0) and 1 = presence of microbleeds (all non-zero values except missing). Then, those images with a low image quality (value = 4; N=`{r} length(Traits_db$qsm_swi_image_quality[Traits_db$qsm_swi_image_quality == 4 & !is.na(Traits_db$qsm_swi_image_quality)])` ) were recoded to missing.

-   Perivascular spaces (variable: epvs_wholebrain_vol) were recoded to missing where the variable 'pvs_exclude' was coded as 1 (N=`{r} length(Traits_db[Traits_db$pvs_exclude ==1 & !is.na(Traits_db$pvs_exclude),]$pvs_exclude)`).

-   White matter hyperintensities (variable: wm_wmh) were divided by 1000 to convert to ml (following Rizwan's code), and those where the variable wmh_exclude had a code of 1 were set to missing.

-   Fractional anisotropy (variable: wmfa) was coded to missing where the variable fa_exclude had a value of 1.

## Covariates

#### True time invariant covariates

-   Race/ethnicity, gender, and highest education level were all taken from exam 1 data. ApoE information was taken from its own dataset (above).

-   ApoE was coded 0/1/2 where 0= no e4 isoform (codes 22, 23, 33), 1 = e4 isoform (24, 34, 44), and 2 = no isoform data. The ApoE variable was formatted as a factor.

-   Gender was coded such that female = 0 and male = 1.

-   Education was recoded 0/1, such that 0 = less than high school (codes: 0: NO SCHOOLING / 1: GRADES 1-8 / 2: GRADES: 9-11) and 1= high school or more (all other codes, excluding missing).

-   Race/ethnicity was recoded retaining the original MESA coded whereby 1=White American; 2= Chinese American, 3=Black, African-American, and 4 = Hispanic. Race/ethnicity was coded as a factor variable.

#### Pseudo-time invariant covariates

-   Although some variables are technically time invariant, where they were included due to their effects on MRI data, since MRI data are only measured at one exam for this analysis (exam 6), these covariates were always taken from exam 6.

-   These 'pseudo time invariant covariates' were: atrial fibrillation, myocardial infarction, congestive heart failure, LDL, systolic blood pressure, hypertension medication, and site (since site seems to affect MRI more than proteins??).

-   Afib, MI, and CHF were coded 0/1, such that 0= no diagnosis and 1= afib diagnosis. Missing data was left as missing (this is different to Rizwan who coded missing data as no diagnosis).

-   Site was arbitrarily coded as 0=Wake forest, 1= Columbia, 2=Johns Hopkins, 3=University of Minnesota, 4=Northwestern, 5=UCLA

-   For the longitudinal analysis only, age at baseline (BL_age) was also included as a covariate, with age excluded from the model - this is because age is conflated with time (days since baseline) introducing a multicollinearity problem.

#### Time varying covariates

-   The following covariates were taken from the exam when the proteins were used, as these were seen to affect proteins more in the short term than they affect MRI (?): kidney function (egfr), BMI , cigarette smoking (never/former/current; coded as ordinal), diabetes status.

-   Smoking was harmonized and coded such that 0 = never smoker, 1= past smoker, 2=current smoker.

-   Diabetes has harmonized and coded such that 0= no diabetes (including impaired fasting glucose), and 1 = diabetes (treated and untreated).

-   The following covariates were taken from exam 6: age (age6c), kidney function (egfr; cepgfr6c), BMI (bmi6c), systolic blood pressure (sbp6c), LDL (ldl6), site(site6c), the use of hypertension medication (htnmed6c; coded 0= no, and 1= yes), cigarette smoking (cig6c), diabetes status (dm036t)

### Missingness

The missingness for each variable those who have at least one MRI measure can be found in @tbl-missing-E6

```{r}
#| label: tbl-missing-E6
#| tbl-cap: Missingness for those who have at least one MRI measure

gt_table <-  missing_cov_info |> 
dplyr::filter(Exam == 6) |>
naniar::miss_var_summary() |>
  gt::gt() |>
  gt::cols_label(variable = "Variable", 
                 n_miss = "Frequency (N)", 
                pct_miss = "Proportion (%)")|>
  gt::as_latex()

gt_table


```

## Sample descriptives

```{r}
#| label: info-for-descrptives

mind_ids <- targets::tar_read(mind_ids)
#protein_and_MIND_ids <- targets::tar_read(protein_and_MIND_ids)
#protein_and_MIND_and_cov_ids <- targets::tar_read(protein_and_MIND_and_cov_ids)
```

-   There were N=`{r} print(length(unique(mind_ids$idno)))` MESA participants with at least one MRI outcome after the exclusions above.

-   Of those with MRI data, N=`{r} print(length(unique(Traits_db$idno)))` participants had protein data, equating to N=`{r} length(unique(Traits_db[which(Traits_db$Exam==1),]$idno))` at exam 1, N=`{r} length(unique(Traits_db[which(Traits_db$Exam==5),]$idno))` at exam 5, and N=`{r} length(unique(Traits_db[which(Traits_db$Exam==6),]$idno))` at exam 6

-   Sample descriptives are available in @tbl-of-descriptives

::: landscape
```{r}
#| label: tbl-of-descriptives
#| tbl-cap: Sample Descriptives

bold_labels <- c(
  "Age (y)", "Gender", "Field Center", "Race or ethnicity", "Highest education level",
  "BMI (kg/m^2^)", "LDL levels", "systolic blood pressure", "Diabetes status",
  "Takes hypertentsion medicine", "Atrial fibrillation", "Myocardial Infarction",
  "Coronary Heart Failure", "ApoeE information", "Smoking status",
  "Kidney function (egfr)", "Intracranial volume", "Fractional anisotropy",
  "White matter hyperintensities", "Enlarged perivascular spaces",
  "Presence of microbleeds?"
)


table1 <- Traits_db |> 
  dplyr::mutate(
        gender_desc = factor(gender,
                       levels = c("0", "1"),
                       labels = c("Female", "Male")),
        Exam_desc = factor(Exam,
                       levels = c("1", "5", "6"),
                       labels = c("Exam 1", "Exam 5", "Exam6")),
        race_desc = factor(race,
                       levels = c("1", "2", "3", "4"),
                       labels = c("Non-Hispanic White", "Chinese American", "Black/African-American", "Hispanic")),
        mb_present_desc = factor(mb_present,
                       levels = c("0", "1"),
                       labels = c("No", "Yes")),
                       smoking_desc = factor(smoking,
                       levels = c("0", "1", "2"),
                       labels = c("Never", "Former", "Current")),
        diabetes_desc = factor(diabetes,
                       levels = c("0", "1"),
                       labels = c("Normoglycemia/IFG", "Diabetes (treated or untreated)")),
        htnmeds_desc = factor(htnmeds,
                       levels = c("0", "1"),
                       labels = c("No", "Yes")),
        edu_desc = factor(edu,
                       levels = c("0", "1"),
                       labels = c("Up to and including high school", "More than high school")),
        E4_desc = factor(E4,
                       levels = c("0", "1", "2"),
                       labels = c("No E4 isoform", "E4 isoform", "No ApoE data")),
        site_desc = factor(site,
                       levels = c("0", "1", "2", "3", "4", "5"),
                       labels = c("Wake Forest", "Columbia","Johns Hopkins", "Minnesota", "Northwestern", "UCLA")),
         AFprevalent_desc = factor(AFprevalent,
                       levels = c("0", "1"),
                       labels = c("No", "Yes")),
        MIprevalent_desc = factor(MIprevalent,
                       levels = c("0", "1"),
                       labels = c("No", "Yes")),
         CHFprevalent_desc = factor(CHFprevalent,
                       levels = c("0", "1"),
                       labels = c("No", "Yes")),
        smoking_desc = factor(smoking,
                       levels = c( "1", "2", "3"),
                       labels = c("Never", "Former", "Current"))
      ) |>
gtsummary::tbl_summary(
    include = c(age, gender_desc, site_desc, edu_desc, race_desc, BMI, smoking_desc, ldl, sbp, diabetes_desc, htnmeds_desc, AFprevalent_desc, MIprevalent_desc, CHFprevalent_desc, E4_desc, egfr, icv, fa, wmh, epvs, mb_present_desc),
    by = Exam,
    statistic = list(
      gtsummary::all_continuous() ~ "{mean} ({sd})",
      gtsummary::all_categorical() ~ "{n} / {N} ({p}%)"
    ),# split table by group
    missing = "no", # don't list missing data separately
    digits = gtsummary::all_continuous() ~ 2, 
   ##add in labels
     label = list(age = "Age (y)",
                 gender_desc = "Gender",
                 site_desc = "Field Center", 
                 race_desc = "Race or ethnicity",
                 edu_desc = "Highest education level",
                 BMI = "BMI (kg/m^2^)",
                 ldl = "LDL levels",
                 sbp = "systolic blood pressure",
                 diabetes_desc = "Diabetes status",
                 htnmeds_desc = "Takes hypertentsion medicine",
                 AFprevalent_desc = "Atrial fibrillation",
                 MIprevalent_desc = "Myocardial Infarction",
                 CHFprevalent_desc = "Coronary Heart Failure",
                 E4_desc = "ApoeE information",
                 smoking_desc = "Smoking status",
                 egfr = "Kidney function (egfr)",
                 icv = "Intracranial volume",
                 fa ="Fractional anisotropy",
                 wmh="White matter hyperintensities",
                 epvs="Enlarged perivascular spaces",
                 mb_present_desc = "Presence of microbleeds?"),
   type = list(age ~ "continuous",
                 gender_desc ~ "categorical",
                 site_desc ~ "categorical", 
                 race_desc ~ "categorical",
                 edu_desc ~ "categorical",
                 BMI ~ "continuous",
                 ldl ~ "continuous",
                 sbp ~ "continuous",
                 diabetes_desc ~ "categorical",
                 htnmeds_desc ~ "categorical",
                 AFprevalent_desc ~ "categorical",
                 MIprevalent_desc ~ "categorical",
                 CHFprevalent_desc ~ "categorical",
                 E4_desc ~ "categorical",
                 smoking_desc ~ "categorical",
                 egfr ~ "continuous",
                 icv ~ "continuous",
                 fa ~ "continuous",
                 wmh ~ "continuous",
                 epvs ~ "continuous",
                 mb_present_desc ~ "categorical"
    ) 
) |>
  gtsummary::modify_spanning_header(
    gtsummary::all_stat_cols() ~ "Exam"
  ) |>
  gtsummary::as_gt() |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::tab_style(
    style = gt::cell_text(weight = "bold"),
    locations = gt::cells_body(
      columns = "label",
      rows = label %in% bold_labels
    )
    ) |>
# Bold *any* spanning headers (includes your "Exam" spanner)
  gt::tab_style(
    style = gt::cell_text(weight = "bold"),
    locations = gt::cells_column_spanners()
  ) |>
  gt::tab_options(latex.use_longtable = TRUE)

table1

rm(bold_labels)
rm(table1)

```
:::

# Step 3: Cross sectional Protein-Wide Association Studies (PWAS)

## Original covariate selection

```{r}
#| label: cross-sectional PWAS data

#Load results

WMH_E6_PWAS <- targets::tar_read(WMH_E6_PWAS)
WMH_E1_PWAS <- targets::tar_read(WMH_E1_PWAS)

EPVS_E6_PWAS <- targets::tar_read(EPVS_E6_PWAS)
EPVS_E1_PWAS <- targets::tar_read(EPVS_E1_PWAS)

MB_E6_PWAS <- targets::tar_read(MB_E6_PWAS)
MB_E1_PWAS <- targets::tar_read(MB_E1_PWAS)

FA_E6_PWAS <- targets::tar_read(FA_E6_PWAS)
FA_E1_PWAS <- targets::tar_read(FA_E1_PWAS)

PWAS_res <- WMH_E6_PWAS |>
  dplyr::full_join(WMH_E1_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(EPVS_E1_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(EPVS_E6_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(MB_E1_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
    dplyr::full_join(MB_E6_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(FA_E1_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(FA_E6_PWAS, dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain))

#Load covariates

wmh_numeric_covs <- targets::tar_read(wmh_numeric_covs)
wmh_factor_covs <- targets::tar_read(wmh_factor_covs)

epvs_numeric_covs <- targets::tar_read(epvs_numeric_covs)
epvs_factor_covs <- targets::tar_read(epvs_factor_covs)

mb_numeric_covs <- targets::tar_read(mb_numeric_covs)
mb_factor_covs <- targets::tar_read(mb_factor_covs)

fa_numeric_covs <- targets::tar_read(fa_numeric_covs)
fa_factor_covs <- targets::tar_read(fa_factor_covs)

#LASSO

FA_E1_LASSO_res <- targets::tar_read(FA_E1_LASSO)
FA_E1_LASSO_importantvars <- as.data.frame(FA_E1_LASSO_res$LASSO_output_important_vars)



```

-   This section includes PWAS where proteins were only used at one time point (exam 1 or exam 6), even if this was not the same time point as when the MRI data were used.

-   All estimates are standardized.

-   The covariate choice was taken from Rizwan's original analysis

### White matter hyperintensity (WMH)

#### Model Specification

-   The associations between WMH and proteins were analyzed via linear regression
-   For WMH the numeric covariates included `{r} print(wmh_numeric_covs)`. ^2^
-   For WMH the factor covariates included `{r} print(wmh_factor_covs)`. ^2^
-   WMH was transformed using an inverse normal transformation (with blom constant).

#### WMH: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for WMH included data from N=`{r} print(max(PWAS_res$wmh_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/WMH_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(wmh_6_fdr < .05 )|> nrow()` exam 6 proteins were significantly associated with WMH at an FDR corrected `P<.05`.

#### WMH: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for WMH included data from N=`{r} print(max(PWAS_res$wmh_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/WMH_E1_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(wmh_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with WMH at an FDR corrected `P<.05`.

### Enlarged Perivascular Spaces (EPVS)

#### Model Specification

-   The associations between EPVS and proteins were analyzed via linear regression
-   For EPVS the numeric covariates included `{r} print(epvs_numeric_covs)`. ^2^
-   For EPVS the factor covariates included `{r} print(epvs_factor_covs)`. ^2^
-   EPVS was transformed using an inverse normal transformation (with blom constant).

#### EPVS: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for EPVS included data from N=`{r} print(max(PWAS_res$epvs_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/EPVS_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(epvs_6_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with EPVS at an FDR corrected `P<.05`

#### EPVS: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for EPVS included data from N=`{r} print(max(PWAS_res$epvs_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/EPVS_E1_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(epvs_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with EPVS at an FDR corrected `P<.05`

### Fractional Anisotropy (FA)

#### Model Specification

-   The associations between FA and proteins were analyzed via linear regression
-   For FA the numeric covariates included `{r} print(fa_numeric_covs)`. ^2^
-   For FA the factor covariates included `{r} print(fa_factor_covs)`. ^2^
-   FA was transformed using an inverse normal transformation (with blom constant).

#### FA: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for FA included data from N=`{r} print(max(PWAS_res$fa_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/FA_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(fa_6_fdr < .05 )|> nrow()` exam 6 proteins were significantly associated with FA at an FDR corrected `P<.05` (see @tbl-fa-E6-sig and @fig-fa-E6).


::: landscape
```{r}
#| label: tbl-fa-E6-sig
#| tbl-cap: Associations Between Exam 6 Proteins and Fractional Anisotropy Reaching an FDR-corrected P<.05 Equivalent

gt_table <-  PWAS_res |> 
  dplyr::filter(fa_6_fdr < .05 )|>
  dplyr::select(Assay, fa_6_nobs, fa_6_beta, fa_6_se, fa_6_pvalue, fa_6_fdr, 
                OlinkID, cv_percent, UniProt) |>
  gt::gt() |>
  gt::cols_label(Assay = "Protein", 
                 fa_6_nobs = "N", 
                 fa_6_beta = "Beta", 
                 fa_6_se = "SE", 
                 fa_6_pvalue = "P", 
                 fa_6_fdr = "P-FDR",
                 OlinkID = "Olink ID", 
                 cv_percent = "Protein CV", 
                 UniProt = "UniProt ID") |>
  gt::fmt_number(columns = c(fa_6_beta, fa_6_se, cv_percent),rows = tidyselect::everything(), decimals = 2) |>
  gt::fmt_scientific(columns = c(fa_6_pvalue, fa_6_fdr), rows = tidyselect::everything(), decimals = 2) |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::as_latex()

gt_table

#knitr::kable(table(gt_table), format="latex")

```

```{r}
#| label: fig-fa-E6
#| fig-cap: Associations Between Exam 6 Proteins and Fractional Anisotropy

full_res <- PWAS_res |>
  dplyr::mutate(diffexpressed = dplyr::case_when(fa_6_beta > 0 & fa_6_fdr < 0.05 ~ "SIG INCREASE",
                                                 fa_6_beta < 0 & fa_6_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(fa_6_beta > 0 & fa_6_fdr < 0.05 ~ "purple", 
                                          fa_6_beta < 0 & fa_6_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(fa_6_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=fa_6_beta, y=-log10(fa_6_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  ggrepel::geom_label_repel(max.overlaps = 100, label.size=0.5, size=4.5,
                   color = full_res$colour, min.segment.length=0) +
  ggplot2::xlab("Standardized beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  #ggplot2::labs(caption = paste("Models control for", paste(paste(wmh_numeric_covs, collapse=","), paste(wmh_factor_covs, collapse=",")), sep=" ")) +
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(fa_numeric_covs, collapse=","), "\n", sep=" "), paste(fa_factor_covs, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```
:::

#### FA: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for FA included data from N=`{r} print(max(PWAS_res$fa_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/FA_E1_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(fa_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with FA at an FDR corrected `P<.05` (see @tbl-fa-E1-sig and @fig-fa-E1 in Appendix 1).

-   Due to the large number of predictors, a pena;ized model was run (elastic net penalty) on a 50:50 test:training split of the data. 

### Microbleeds (MB)

#### Model Specification

-   The associations between MB and proteins were analyzed via logistic regression (MB coded as 'present' vs. 'absent' as above)
-   For MB the numeric covariates included `{r} print(mb_numeric_covs)`. ^2^
-   For MB the factor covariates included `{r} print(mb_factor_covs)`. ^2^

#### MB: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for MB included data from N= `{r} print(max(PWAS_res$mb_present_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/MB_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(mb_present_6_fdr < .05 )|> nrow()` exam 6 proteins were significantly associated with MB at an FDR corrected `P<.05`.

#### MB: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for FA included data from N=`{r} print(max(PWAS_res$mb_present_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/MB_E1_PWAS.csv)

-   A total of N=`{r} PWAS_res |> dplyr::filter(mb_present_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with MB at an FDR correct `P<.05`.

\newpage

## Reduced covariate selection

This section repeats the cross-sectional PWAS, using the set of covariates recommended by Tim.

```{r}
#| label: cross-sectional PWAS data with reduced covariates

#Load results

WMH_E6_PWAS_reducedcov <- targets::tar_read(WMH_E6_PWAS_reducedcov)
WMH_E1_PWAS_reducedcov  <- targets::tar_read(WMH_E1_PWAS_reducedcov) 
EPVS_E6_PWAS_reducedcov  <- targets::tar_read(EPVS_E6_PWAS_reducedcov)
EPVS_E1_PWAS_reducedcov  <- targets::tar_read(EPVS_E1_PWAS_reducedcov)

MB_E6_PWAS_reducedcov  <- targets::tar_read(MB_E6_PWAS_reducedcov)
MB_E1_PWAS_reducedcov  <- targets::tar_read(MB_E1_PWAS_reducedcov)

FA_E6_PWAS_reducedcov  <- targets::tar_read(FA_E6_PWAS_reducedcov)
FA_E1_PWAS_reducedcov  <- targets::tar_read(FA_E1_PWAS_reducedcov)

PWAS_res_reducedcov  <- WMH_E6_PWAS_reducedcov  |>
  dplyr::full_join(WMH_E1_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(EPVS_E1_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(EPVS_E6_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(MB_E1_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
    dplyr::full_join(MB_E6_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(FA_E1_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain)) |>
  dplyr::full_join(FA_E6_PWAS_reducedcov , dplyr::join_by(OlinkID, cv_percent, UniProt, Assay, Panel, Retain))

#Load covariates

wmh_numeric_covs_reducedcov  <- targets::tar_read(wmh_numeric_covs_reducedcov )
wmh_factor_covs_reducedcov  <- targets::tar_read(wmh_factor_covs_reducedcov )

epvs_numeric_covs_reducedcov  <- targets::tar_read(epvs_numeric_covs_reducedcov )
epvs_factor_covs_reducedcov  <- targets::tar_read(epvs_factor_covs_reducedcov )

mb_numeric_covs_reducedcov  <- targets::tar_read(mb_numeric_covs_reducedcov )
mb_factor_covs_reducedcov  <- targets::tar_read(mb_factor_covs_reducedcov )

fa_numeric_covs_reducedcov  <- targets::tar_read(fa_numeric_covs_reducedcov )
fa_factor_covs_reducedcov  <- targets::tar_read(fa_factor_covs_reducedcov )

#Load LASSO

FA_E1_LASSO_reducedcov_res <- targets::tar_read(FA_E1_LASSO_reducedcov_res)
FA_E1_LASSO_reducedcov_importantvars <- as.data.frame(FA_E1_LASSO_reducedcov_res$LASSO_output_important_vars)

```

-   This section includes PWAS where proteins were only used at one time point (exam 1 or exam 6), even if this was not the same time point as when the MRI data were used.

-   All estimates are standardized.

### White matter hyperintensity (WMH)

#### Model Specification

-   The associations between WMH and proteins were analyzed via linear regression
-   For WMH the numeric covariates included `{r} print(wmh_numeric_covs_reducedcov)`. ^2^
-   For WMH the factor covariates included `{r} print(wmh_factor_covs_reducedcov)`. ^2^
-   WMH was transformed using an inverse normal transformation (with blom constant).

#### WMH: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for WMH included data from N=`{r} print(max(PWAS_res_reducedcov$wmh_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/WMH_E6_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov  |> dplyr::filter(wmh_6_fdr < .05 )|> nrow()` exam 6 proteins were significantly associated with WMH at an FDR corrected `P<.05`.

#### WMH: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for WMH included data from N=`{r} print(max(PWAS_res_reducedcov$wmh_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/WMH_E1_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(wmh_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with WMH at an FDR corrected P\<.05.

### Enlarged Perivascular Spaces (EPVS)

#### Model Specification

-   The associations between EPVS and proteins were analyzed via linear regression
-   For EPVS the numeric covariates included `{r} print(epvs_numeric_covs_reducedcov)`. ^2^
-   For EPVS the factor covariates included `{r} print(epvs_factor_covs_reducedcov)`. ^2^
-   EPVS was transformed using an inverse normal transformation (with blom constant).

### EPVS: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for EPVS included data from N=`{r} print(max(PWAS_res_reducedcov$epvs_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/EPVS_E6_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(epvs_6_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with EPVS at an FDR corrected `P<.05`

#### EPVS: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for EPVS included data from N=`{r} print(max(PWAS_res$epvs_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/EPVS_E1_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(epvs_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with EPVS at an FDR corrected `P<.05`

### Fractional Anisotropy (FA)

#### Model Specification

-   The associations between FA and proteins were analyzed via linear regression
-   For FA the numeric covariates included `{r} print(fa_numeric_covs_reducedcov)`. ^2^
-   For FA the factor covariates included `{r} print(fa_factor_covs_reducedcov)`. ^2^
-   FA was transformed using an inverse normal transformation (with blom constant).

#### FA: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for FA included data from N=`{r} print(max(PWAS_res_reducedcov$fa_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/FA_E6_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(fa_6_fdr < .05 )|> nrow()` exam 6 proteins were significantly associated with FA at an FDR corrected `P<.05` (see @tbl-fa-E6-sig-reducedcov and @fig-fa-E6-reducedcov).

#### FA: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for FA included data from N=`{r} print(max(PWAS_res_reducedcov$fa_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/FA_E1_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(fa_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with FA at an FDR corrected `P<.05` (see @tbl-fa-E1-sig-reducedcov and @fig-fa-E1-reducedcov in Appendix 1).

::: landscape
```{r}
#| label: tbl-fa-E6-sig-reducedcov
#| tbl-cap: Associations Between Exam 6 Proteins and Fractional Anisotropy Reaching an FDR-corrected P<.05 Equivalent with a Reduced Number of Covariates Included in the Model

gt_table <-  PWAS_res_reducedcov |> 
  dplyr::filter(fa_6_fdr < .05 )|>
  dplyr::select(Assay, fa_6_nobs, fa_6_beta, fa_6_se, fa_6_pvalue, fa_6_fdr, 
                OlinkID, cv_percent, UniProt) |>
  gt::gt() |>
  gt::cols_label(Assay = "Protein", 
                 fa_6_nobs = "N", 
                 fa_6_beta = "Beta", 
                 fa_6_se = "SE", 
                 fa_6_pvalue = "P", 
                 fa_6_fdr = "P-FDR",
                 OlinkID = "Olink ID", 
                 cv_percent = "Protein CV", 
                 UniProt = "UniProt ID") |>
  gt::fmt_number(columns = c(fa_6_beta, fa_6_se, cv_percent),rows = tidyselect::everything(), decimals = 2) |>
  gt::fmt_scientific(columns = c(fa_6_pvalue, fa_6_fdr), rows = tidyselect::everything(), decimals = 2) |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::as_latex()

gt_table

#knitr::kable(table(gt_table), format="latex")

```

```{r}
#| label: fig-fa-E6-reducedcov
#| fig-cap: Associations Between Exam 6 Proteins and Fractional Anisotropy with a Reduced Number of Covariates

full_res <- PWAS_res_reducedcov |>
  dplyr::mutate(diffexpressed = dplyr::case_when(fa_6_beta > 0 & fa_6_fdr < 0.05 ~ "SIG INCREASE",
                                                 fa_6_beta < 0 & fa_6_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(fa_6_beta > 0 & fa_6_fdr < 0.05 ~ "purple", 
                                          fa_6_beta < 0 & fa_6_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(fa_6_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=fa_6_beta, y=-log10(fa_6_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  ggrepel::geom_label_repel(max.overlaps = 100, label.size=0.5, size=4.5,
                   color = full_res$colour, min.segment.length=0) +
  ggplot2::xlab("Standardized beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  #ggplot2::labs(caption = paste("Models control for", paste(paste(wmh_numeric_covs, collapse=","), paste(wmh_factor_covs, collapse=",")), sep=" ")) +
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(fa_numeric_covs_reducedcov, collapse=","), "\n", sep=" "), paste(fa_factor_covs_reducedcov, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```
:::

### Microbleeds (MB)

#### Model Specification

-   The associations between MB and proteins were analyzed via logistic regression (MB coded as 'present' vs. 'absent' as above)
-   For MB the numeric covariates included `{r} print(mb_numeric_covs_reducedcov)`. ^2^
-   For MB the factor covariates included `{r} print(mb_factor_covs_reducedcov)`. ^2^

#### MB: Exam 6 proteins

-   The E6 proteins `->` E6 MRI for MB included data from N= `{r} print(max(PWAS_res_reducedcov$mb_present_6_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/MB_E6_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(mb_present_6_fdr < .05 )|> nrow()` exam 6 proteins were significantly associated with MB at an FDR corrected `P<.05` (see @tbl-MB-E6-sig-reducedcov and @fig-MB-E6-reducedcov).

#### MB: Exam 1 proteins

-   The E1 proteins `->` E6 MRI for FA included data from N=`{r} print(max(PWAS_res_reducedcov$mb_present_1_nobs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/MB_E1_PWAS_reducedcov.csv)

-   A total of N=`{r} PWAS_res_reducedcov |> dplyr::filter(mb_present_1_fdr < .05 )|> nrow()` exam 1 proteins were significantly associated with MB at an FDR corrected `P<.05`.

::: landscape
```{r}
#| label: tbl-MB-E6-sig-reducedcov
#| tbl-cap: Associations Between Exam 6 Proteins and Microbleeds Reaching an FDR-corrected P<.05 Equivalent with a Reduced Number of Covariates Included in the Model

gt_table <-  PWAS_res_reducedcov |> 
  dplyr::filter(mb_present_6_fdr < .05 )|>
  dplyr::select(Assay, mb_present_6_nobs, mb_present_6_OR, mb_present_6_CI_lower, mb_present_6_CI_upper, mb_present_6_pvalue, mb_present_6_fdr, 
                OlinkID, cv_percent, UniProt) |>
  gt::gt() |>
  gt::cols_label(Assay = "Protein", 
                 mb_present_6_nobs = "N", 
                 mb_present_6_OR = "OR", 
                 mb_present_6_CI_lower = "Lower CI", 
                 mb_present_6_CI_upper = "Upper CI", 
                 mb_present_6_pvalue = "P", 
                 mb_present_6_fdr = "P-FDR",
                 OlinkID = "Olink ID", 
                 cv_percent = "Protein CV", 
                 UniProt = "UniProt ID") |>
  gt::fmt_number(columns = c(mb_present_6_OR, mb_present_6_CI_lower, mb_present_6_CI_upper, cv_percent),rows = tidyselect::everything(), decimals = 2) |>
  gt::fmt_scientific(columns = c(mb_present_6_pvalue, mb_present_6_fdr ), rows = tidyselect::everything(), decimals = 2) |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::as_latex()

gt_table

#knitr::kable(table(gt_table), format="latex")

```

```{r}
#| label: fig-MB-E6-reducedcov
#| fig-cap: Associations Between Exam 6 Proteins and Fractional Anisotropy with a Reduced Number of Covariates

full_res <- PWAS_res_reducedcov |>
  dplyr::mutate(diffexpressed = dplyr::case_when(mb_present_6_OR > 1 & mb_present_6_fdr < 0.05 ~ "SIG INCREASE",
                                                 mb_present_6_OR < 1 & mb_present_6_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(mb_present_6_OR > 1 & mb_present_6_fdr < 0.05 ~ "purple", 
                                          mb_present_6_OR < 1 & mb_present_6_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(mb_present_6_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=mb_present_6_OR, y=-log10(mb_present_6_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  ggrepel::geom_label_repel(max.overlaps = 100, label.size=0.5, size=4.5,
                   color = full_res$colour, min.segment.length=0) +
  ggplot2::xlab("Standardized OR") +
  ggplot2::ylab("log10(P-FDR)") + 
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(mb_numeric_covs_reducedcov, collapse=","), "\n", sep=" "), paste(mb_factor_covs_reducedcov, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```
:::

# Step 4: Longitudinal models

## Tim / Lekki covariate selection

```{r}
#| label: longitudinal PWAS data

#Load results

WMH_PWAS <- targets::tar_read(WMH_LongPWAS)
EPVS_PWAS <- targets::tar_read(EPVS_LongPWAS)
MB_PWAS <- targets::tar_read(MB_LongPWAS)
FA_PWAS <- targets::tar_read(FA_LongPWAS)

prot_info <- PWAS_res_reducedcov |>
  dplyr::select(OlinkID, cv_percent, UniProt, Assay)

PWAS_res_long <- WMH_PWAS |>
  dplyr::full_join(EPVS_PWAS, dplyr::join_by(protein)) |>
  dplyr::full_join(MB_PWAS, dplyr::join_by(protein)) |>
  dplyr::full_join(FA_PWAS, dplyr::join_by(protein)) |>
  dplyr::rename(OlinkID = protein) |>
  dplyr::full_join(prot_info, dplyr::join_by(OlinkID))

#Load covariates

wmh_numeric_covs_long <- targets::tar_read(wmhlong_numeric_covs)
wmh_factor_covs_long <- targets::tar_read(wmhlong_factor_covs)

epvs_numeric_covs_long <- targets::tar_read(epvslong_numeric_covs)
epvs_factor_covs_long <- targets::tar_read(epvslong_factor_covs)

mb_numeric_covs_long <- targets::tar_read(mblong_numeric_covs)
mb_factor_covs_long <- targets::tar_read(mblong_factor_covs)

fa_numeric_covs_long <- targets::tar_read(falong_numeric_covs)
fa_factor_covs_long <- targets::tar_read(falong_factor_covs)


```

-   This section includes PWAS where proteins were only used at three time points (exam 1, exam 5 and exam 6) in a single model.

-   Accordingly, all models were nested within person

-   Note: that for the model to have any within-person variance (needed for an MLM) proteins had to be the outcome

-   In each model, the MRI was allowed to have an interaction with time, which is the parameter of interest. This parameter is interpreted as showing whether each MRI measure is associated with a different linear change in the protein over time, in the `~20` years prior to the MRI being conducted.

-   All estimates are standardized.

-   The covariate choice was decided between Tim and Lekki

### White matter hyperintensity (WMH)

#### Model Specification

-   The associations between WMH and proteins were analyzed via linear regression
-   For WMH the numeric covariates included `{r} print(wmh_numeric_covs_long)`. ^2^
-   For WMH the factor covariates included `{r} print(wmh_factor_covs_long)`. ^2^
-   WMH was transformed using an inverse normal transformation (with blom constant).

#### WMH: Longitudinal Associations with Prior Change in Proteins

-   The longitudinal WMH model included data from N=`{r} print(max(PWAS_res_long$Nobs_wmh, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/WMH_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res_long |> dplyr::filter(P_time_wmh_int_fdr < .05 )|> nrow()` proteins were significantly associated with WMH at an FDR corrected `P<.05`. (see @tbl-WMHlong-sig in Appendix 2 and @fig-WMHlong below).

::: landscape
```{r}
#| label: fig-WMHlong
#| fig-cap: Associations Between Differences in Protein Changes over Time Prior to Measuring with White Matter Hyperintensities

full_res <- PWAS_res_long |>
  dplyr::mutate(diffexpressed = dplyr::case_when(beta_int_time_wmh > 0 & P_time_wmh_int_fdr < 0.05 ~ "SIG INCREASE",
                                                 beta_int_time_wmh < 0 & P_time_wmh_int_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(beta_int_time_wmh > 0 & P_time_wmh_int_fdr < 0.05 ~ "purple", 
                                          beta_int_time_wmh < 0 & P_time_wmh_int_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(P_time_wmh_int_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=beta_int_time_wmh, y=-log10(P_time_wmh_int_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  ggrepel::geom_label_repel(
  size = 1.6,                 # very small text
  label.size = 0.15,          # very thin box outline
  box.padding = 0.08,
  point.padding = 0.05,
  segment.size = 0.15,
  min.segment.length = 0,
  max.overlaps = Inf,
  color = full_res$colour) +
  ggplot2::xlab("Standardized Beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(wmh_numeric_covs_long, collapse=","), "\n", sep=" "), paste(wmh_factor_covs_long, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```
:::

### Enlarged Perivascular Spaces (EPVS)

#### Model Specification

-   The associations between EPVS and proteins were analyzed via linear regression
-   For EPVS the numeric covariates included `{r} print(epvs_numeric_covs_long)`. ^2^
-   For EPVS the factor covariates included `{r} print(epvs_factor_covs_long)`. ^2^
-   EPVS was transformed using an inverse normal transformation (with blom constant).

#### EPVS: Longitudinal Associationd with Prior Change in Proteins

-   The longitudinal EPVS model included data from N=`{r} print(max(PWAS_res_long$Nobs_epvs, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/EPVS_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res_long |> dplyr::filter(P_time_epvs_int_fdr < .05 )|> nrow()` proteins were significantly associated with EPVS at an FDR corrected `P<.05`. (see @tbl-EPVSlong-sig in Appendix 2 and @fig-EPVSlong below).

::: landscape
```{r}
#| label: fig-EPVSlong
#| fig-cap: Associations Between Differences in Protein Changes over Time Prior to Measuring with White Matter Hyperintensities

full_res <- PWAS_res_long |>
  dplyr::mutate(diffexpressed = dplyr::case_when(beta_int_time_epvs > 0 & P_time_epvs_int_fdr < 0.05 ~ "SIG INCREASE",
                                                 beta_int_time_epvs < 0 & P_time_epvs_int_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(beta_int_time_epvs > 0 & P_time_epvs_int_fdr < 0.05 ~ "purple", 
                                          beta_int_time_epvs < 0 & P_time_epvs_int_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(P_time_epvs_int_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=beta_int_time_epvs, y=-log10(P_time_epvs_int_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  ggrepel::geom_label_repel(
    size = 1.6,                 # very small text
    label.size = 0.15,          # very thin box outline
    box.padding = 0.08,
    point.padding = 0.05,
    segment.size = 0.15,
    min.segment.length = 0,
    max.overlaps = Inf,
    color = full_res$colour) +
  ggplot2::xlab("Standardized Beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(epvs_numeric_covs_long, collapse=","), "\n", sep=" "), paste(epvs_factor_covs_long, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```
:::

### Microbleeds (MBs)

#### Model Specification

-   The associations between MBs and proteins were analyzed via linear regression
-   For MBs the numeric covariates included `{r} print(mb_numeric_covs_long)`. ^2^
-   For MBs the factor covariates included `{r} print(mb_factor_covs_long)`. ^2^
-   MBs was transformed using an inverse normal transformation (with blom constant).

#### MBs: Longitudinal Associations with Prior Change in Proteins

-   The longitudinal MBs model included data from N=`{r} print(max(PWAS_res_long$Nobs_mb_present, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/MBs_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res_long |> dplyr::filter(P_time_mb_present_int_fdr < .05 )|> nrow()` proteins were significantly associated with MBs at an FDR corrected `P<.05`.

### Fractional anisotropy (FA)

#### Model Specification

-   The associations between FA and proteins were analyzed via linear regression
-   For FA the numeric covariates included `{r} print(fa_numeric_covs_long)`. ^2^
-   For FA the factor covariates included `{r} print(fa_factor_covs_long)`. ^2^
-   FA was transformed using an inverse normal transformation (with blom constant).

#### FA: Longitudinal Associationd with Prior Change in Proteins

-   The longitudinal FA model included data from N=`{r} print(max(PWAS_res_long$Nobs_fa, na.rm=TRUE))` participants.

-   Full results can be found [here](https://github.com/LekkiWood/MESA-MIND-Longitudinal-Proteomics-cSVD/blob/main/outputs/FA_E6_PWAS.csv)

-   A total of N=`{r} PWAS_res_long |> dplyr::filter(P_time_fa_int_fdr < .05 )|> nrow()` proteins were significantly associated with FA at an FDR corrected `P<.05`. (see @tbl-FAlong-sig in Appendix 2 and @fig-FAlong below).

::: landscape
```{r}
#| label: fig-FAlong
#| fig-cap: Associations Between Differences in Protein Changes over Time Prior to Measuring with White Matter Hyperintensities

full_res <- PWAS_res_long |>
  dplyr::mutate(diffexpressed = dplyr::case_when(beta_int_time_fa > 0 & P_time_fa_int_fdr < 0.05 ~ "SIG INCREASE",
                                                 beta_int_time_fa < 0 & P_time_fa_int_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(beta_int_time_fa > 0 & P_time_fa_int_fdr < 0.05 ~ "purple", 
                                          beta_int_time_fa < 0 & P_time_fa_int_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(P_time_fa_int_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=beta_int_time_fa, y=-log10(P_time_fa_int_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  ggrepel::geom_label_repel(
    size = 1.6,                 # very small text
    label.size = 0.15,          # very thin box outline
    box.padding = 0.08,
    point.padding = 0.05,
    segment.size = 0.15,
    min.segment.length = 0,
    max.overlaps = Inf,
    color = full_res$colour) +
  ggplot2::xlab("Standardized Beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(fa_numeric_covs_long, collapse=","), "\n", sep=" "), paste(fa_factor_covs_long, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```

\newpage


# Appendix 1 : Full results for fractional anisotropy and exam 1 proteins


## Full covariates

```{r}
#| label: tbl-fa-E1-sig
#| tbl-cap: Associations Between Exam 1 Proteins and Fractional Anisotropy Reaching an FDR-corrected P<.05 Equivalent

gt_table <- PWAS_res |>
  dplyr::filter(fa_1_fdr < 0.05) |>
  dplyr::select(
    Assay, fa_1_nobs, fa_1_beta, fa_1_se, fa_1_pvalue, fa_1_fdr,
    OlinkID, cv_percent, UniProt
  ) |>
  gt::gt() |>
  gt::cols_label(
    Assay = "Protein",
    fa_1_nobs = "N",
    fa_1_beta = "Beta",
    fa_1_se = "SE",
    fa_1_pvalue = "P",
    fa_1_fdr = "P-FDR",
    OlinkID = "Olink ID",
    cv_percent = "Protein CV",
    UniProt = "UniProt ID"
  ) |>
  gt::fmt_number(columns = c(fa_1_beta, fa_1_se, cv_percent), decimals = 2) |>
  gt::fmt_scientific(columns = c(fa_1_pvalue, fa_1_fdr), decimals = 2) |>
  gt::tab_options(latex.use_longtable = TRUE)

gt_table

#knitr::kable(table(gt_table), format="latex")

```

```{r}
#| label: fig-fa-E1
#| fig-cap: Associations Between Exam 1 Proteins and Fractional Anisotropy
#| fig-width: 13
#| fig-height: 9

full_res <- PWAS_res |>
  dplyr::mutate(diffexpressed = dplyr::case_when(fa_1_beta > 0 & fa_1_fdr < 0.05 ~ "SIG INCREASE",
                                                 fa_1_beta < 0 & fa_1_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(fa_1_beta > 0 & fa_1_fdr < 0.05 ~ "purple", 
                                          fa_1_beta < 0 & fa_1_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(fa_1_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=fa_1_beta, y=-log10(fa_1_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  #ggrepel::geom_label_repel(max.overlaps = 500, label.size=0.3, size=2.5,
  #color = full_res$colour, min.segment.length=0) +
  ggrepel::geom_label_repel(
    size = 1.6,                 # very small text
    label.size = 0.15,          # very thin box outline
    box.padding = 0.08,
    point.padding = 0.05,
    segment.size = 0.15,
    min.segment.length = 0,
    max.overlaps = Inf,
    color = full_res$colour) +
  ggplot2::xlab("Standardized beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  #ggplot2::labs(caption = paste("Models control for", paste(paste(wmh_numeric_covs, collapse=","), paste(wmh_factor_covs, collapse=",")), sep=" ")) +
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(fa_numeric_covs, collapse=","), "\n", sep=" "), paste(fa_factor_covs, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```

\newpage

## Reduced covariates

```{r}
#| label: tbl-fa-E1-sig-reducedcov
#| tbl-cap: Associations Between Exam 1 Proteins and Fractional Anisotropy Reaching an FDR-corrected P<.05 Equivalent with a Reduced Numer of Covariates in the Model

gt_table <- PWAS_res_reducedcov |>
  dplyr::filter(fa_1_fdr < 0.05) |>
  dplyr::select(
    Assay, fa_1_nobs, fa_1_beta, fa_1_se, fa_1_pvalue, fa_1_fdr,
    OlinkID, cv_percent, UniProt
  ) |>
  gt::gt() |>
  gt::cols_label(
    Assay = "Protein",
    fa_1_nobs = "N",
    fa_1_beta = "Beta",
    fa_1_se = "SE",
    fa_1_pvalue = "P",
    fa_1_fdr = "P-FDR",
    OlinkID = "Olink ID",
    cv_percent = "Protein CV",
    UniProt = "UniProt ID"
  ) |>
  gt::fmt_number(columns = c(fa_1_beta, fa_1_se, cv_percent), decimals = 2) |>
  gt::fmt_scientific(columns = c(fa_1_pvalue, fa_1_fdr), decimals = 2) |>
  gt::tab_options(latex.use_longtable = TRUE)

gt_table

#knitr::kable(table(gt_table), format="latex")

```

\newpage

```{r}
#| label: fig-fa-E1-reducedcov
#| fig-cap: Associations Between Exam 1 Proteins and Fractional Anisotropy with Reduced Covariates
#| fig-width: 13
#| fig-height: 9

full_res <- PWAS_res_reducedcov |>
  dplyr::mutate(diffexpressed = dplyr::case_when(fa_1_beta > 0 & fa_1_fdr < 0.05 ~ "SIG INCREASE",
                                                 fa_1_beta < 0 & fa_1_fdr < 0.05 ~ "SIG DECREASE",
                                                 TRUE ~ "NO SIG CHANGE"), 
                colour = dplyr::case_when(fa_1_beta > 0 & fa_1_fdr < 0.05 ~ "purple", 
                                          fa_1_beta < 0 & fa_1_fdr < 0.05 ~ "blue",
                                          TRUE ~ "slategrey"),
                label= dplyr::case_when(fa_1_fdr < 0.05 ~ Assay,
                                        TRUE ~ NA_character_))

ggplot2::ggplot(data=full_res, ggplot2::aes(x=fa_1_beta, y=-log10(fa_1_fdr), color=diffexpressed, label=label)) + 
  ggplot2::geom_point(size=1.5, color=full_res$colour) + 
  ggplot2::theme_minimal() +
  #ggrepel::geom_label_repel(max.overlaps = 500, label.size=0.3, size=2.5,
  #color = full_res$colour, min.segment.length=0) +
  ggrepel::geom_label_repel(
    size = 1.6,                 # very small text
    label.size = 0.15,          # very thin box outline
    box.padding = 0.08,
    point.padding = 0.05,
    segment.size = 0.15,
    min.segment.length = 0,
    max.overlaps = Inf,
    color = full_res$colour) +
  ggplot2::xlab("Standardized beta") +
  ggplot2::ylab("log10(P-FDR)") + 
  #ggplot2::labs(caption = paste("Models control for", paste(paste(wmh_numeric_covs, collapse=","), paste(wmh_factor_covs, collapse=",")), sep=" ")) +
  ggplot2::labs(caption = paste("Models control for", paste(paste(paste(fa_numeric_covs_reducedcov, collapse=","), "\n", sep=" "), paste(fa_factor_covs_reducedcov, collapse=",")), sep=" ")) +
  ggplot2::theme(plot.caption = ggplot2::element_text(hjust = 0))


rm(full_res)

```

\newpage

# Appendix 2: Longitudinal Associations

## White Matter Hyperintensities

```{r}
#| label: tbl-WMHlong-sig
#| tbl-cap: Associations Between Differences in Changes in Proteins over Timne with WMH Reaching an FDR-corrected P<.05

gt_table <-  PWAS_res_long |> 
  dplyr::filter(P_time_wmh_int_fdr < .05 )|>
  dplyr::select(Assay, Nobs_wmh, beta_time_wmh, P_wmh_fdr, beta_time_wmh, P_time_wmh_fdr, beta_int_time_wmh, P_time_wmh_int_fdr) |>
  gt::gt() |>
  gt::cols_label(Assay = "Protein", 
                 Nobs_wmh = "N", 
                 beta_time_wmh = "B-WMH", 
                 P_wmh_fdr = "P-fdr-WMH", 
                 beta_time_wmh = "B-time", 
                 P_time_wmh_fdr = "P-fdr-time", 
                 beta_int_time_wmh = "B-interaction", 
                 P_time_wmh_int_fdr = "P-fdr-interaction") |>
  gt::fmt_number(columns = c(beta_time_wmh, 
                             beta_time_wmh, 
                             beta_int_time_wmh),rows = tidyselect::everything(), decimals = 2) |>
  gt::fmt_scientific(columns = c(P_wmh_fdr, 
                                 P_time_wmh_fdr, 
                                 P_time_wmh_int_fdr), rows = tidyselect::everything(), decimals = 2) |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::as_latex()

gt_table


```

\newpage

## Enlarged Perivascular Spaces (EPVS)

```{r}
#| label: tbl-EPVSlong-sig
#| tbl-cap: Associations Between Differences in Changes in Proteins over Timne with EPVS Reaching an FDR-corrected P<.05

gt_table <-  PWAS_res_long |> 
  dplyr::filter(P_time_epvs_int_fdr < .05 )|>
  dplyr::select(Assay, Nobs_epvs, beta_time_epvs, P_epvs_fdr, beta_time_epvs, P_time_epvs_fdr, beta_int_time_epvs, P_time_epvs_int_fdr) |>
  gt::gt() |>
  gt::cols_label(Assay = "Protein", 
                 Nobs_epvs = "N", 
                 beta_time_epvs = "B-EPVS", 
                 P_epvs_fdr = "P-fdr-EPVS", 
                 beta_time_epvs = "B-time", 
                 P_time_epvs_fdr = "P-fdr-time", 
                 beta_int_time_epvs = "B-interaction", 
                 P_time_epvs_int_fdr = "P-fdr-interaction") |>
  gt::fmt_number(columns = c(beta_time_epvs, 
                             beta_time_epvs, 
                             beta_int_time_epvs),rows = tidyselect::everything(), decimals = 2) |>
  gt::fmt_scientific(columns = c(P_epvs_fdr, 
                                 P_time_epvs_fdr, 
                                 P_time_epvs_int_fdr), rows = tidyselect::everything(), decimals = 2) |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::as_latex()

gt_table


```

\newpage

## Fractional anisotropy

```{r}
#| label: tbl-FAlong-sig
#| tbl-cap: Associations Between Differences in Changes in Proteins over Timne with FA Reaching an FDR-corrected P<.05

gt_table <-  PWAS_res_long |> 
  dplyr::filter(P_time_fa_int_fdr < .05 )|>
  dplyr::select(Assay, Nobs_fa, beta_time_fa, P_fa_fdr, beta_time_fa, P_time_fa_fdr, beta_int_time_fa, P_time_fa_int_fdr) |>
  gt::gt() |>
  gt::cols_label(Assay = "Protein", 
                 Nobs_fa = "N", 
                 beta_time_fa = "B-FA", 
                 P_fa_fdr = "P-fdr-FA", 
                 beta_time_fa = "B-time", 
                 P_time_fa_fdr = "P-fdr-time", 
                 beta_int_time_fa = "B-interaction", 
                 P_time_fa_int_fdr = "P-fdr-interaction") |>
  gt::fmt_number(columns = c(beta_time_fa, 
                             beta_time_fa, 
                             beta_int_time_fa),rows = tidyselect::everything(), decimals = 2) |>
  gt::fmt_scientific(columns = c(P_fa_fdr, 
                                 P_time_fa_fdr, 
                                 P_time_fa_int_fdr), rows = tidyselect::everything(), decimals = 2) |>
  gt::tab_options(page.orientation = "landscape") |>
  gt::as_latex()

gt_table


```
:::

# Appendix 3: Further information

## Notes

## Footnotes

^1^ This is a reproducible file for many runs, containing many data checks. Values of 0 or NULL are expected, and just indicate no problem with the data.

^2^ These are intentionally written as variable names to avoid reproducibility errors.

## Session info for reproducibility

```{r}
#| label: session-info

# Prefer the detailed sessioninfo output; otherwise fall back to base.
if (requireNamespace("sessioninfo", quietly = TRUE)) {
  sessioninfo::session_info()
} else {
  sessionInfo()
}
```

```{r 'venn2', eval=FALSE}

library(VennDiagram)

log_folder <- "Archive/venn_logs"

# Create the directory if it doesn't exist
if (!dir.exists(log_folder)) {
  dir.create(log_folder)
}

output_file_path <- file.path(log_folder, "my_venn_diagram.png")





WMH_temp <- subset(PWAS_res_long, select=Assay, P_time_wmh_int_fdr<.05)
WMH_temp$Var <- "WMH"

FA_temp <- subset(PWAS_res_long, select=Assay, P_time_fa_int_fdr<.05)
FA_temp$Var <- "FA"

EPVS_temp <- subset(PWAS_res_long, select=Assay, P_time_epvs_int_fdr<.05)
EPVS_temp$Var <- "EPVS"

Venn_F1 <- rbind(WMH_temp, FA_temp)
#rm(CONGA_temp)
#rm(MAGE_temp)
Venn_F1 <- rbind(Venn_F1, EPVS_temp)
#rm(TATR_temp)

venn.plot <- venn.diagram(x = list(
  Venn_F1 %>% filter(Var=="WMH") %>% dplyr::select(Assay) %>% unlist() , 
  Venn_F1 %>% filter(Var=="FA") %>% dplyr::select(Assay) %>% unlist() , 
  Venn_F1 %>% filter(Var=="EPVS") %>% dplyr::select(Assay) %>% unlist() 
),
category.names = c("WMH" , "FA" , "EPVS"),
filename = output_file_path,
output = TRUE ,
imagetype="png" ,
height = 700 , 
width = 700 , 
resolution = 400,
compression = "lzw",
lwd = 0.5,

col=c('blue', 'red', 'chartreuse3'),
fill = c('blue', 'red', 'chartreuse3'),

cex = 2,
fontfamily = "sans",
cat.cex = 2,
cat.default.pos = "text", 
#cat.pos = c(0, 90, 180),
cat.dist = c(0, 0, 0),
cat.fontfamily = "sans",
cat.col = c("grey0", 'grey0', 'grey0'),
margin=0,
main="",
main.cex=0.3, 
cat.just=list(c(0.5,-1), c(0.8,-1) , c(0.5,-1))
)

#png(file="/Users/lekki/Library/CloudStorage/GoogleDrive-lekki.wood@gmail.com/My #Drive/Conferences and Presentations/Conferences/ADA Scientific Sessions #2026/CGM/venn_diagram.png", width=700, height=500)
grid.newpage()
grid.draw(venn.plot)
#dev.off()

```
